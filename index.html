<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="mobile-web-app-capable" content="no">
        <meta name="apple-mobile-web-app-capable" content="no">
        <title>Web Parallax</title>
        
        <!-- Disable VR features before A-Frame loads -->
        <script>
            // Completely disable VR and sensor access at browser level
            if (window.location.protocol !== "https:") {
                // Override WebXR APIs
                if (navigator.xr) {
                    navigator.xr.isSessionSupported = () => Promise.resolve(false);
                    navigator.xr.requestSession = () => Promise.reject(new Error("WebXR not supported"));
                }
                
                // Override VR display APIs
                if (navigator.getVRDisplays) {
                    navigator.getVRDisplays = () => Promise.resolve([]);
                }
                
                if (navigator.getVRDisplaysAsync) {
                    navigator.getVRDisplaysAsync = () => Promise.resolve([]);
                }
                
                // Override device orientation APIs
                if (window.DeviceOrientationEvent) {
                    window.DeviceOrientationEvent.requestPermission = () => Promise.resolve("denied");
                }
                
                if (window.DeviceMotionEvent) {
                    window.DeviceMotionEvent.requestPermission = () => Promise.resolve("denied");
                }
                
                console.log("VR and sensor features disabled - running in standard mode");
            }
        </script>
        
        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
        <!--Loading libraries related with TensorFlow-->
        <script src="https://unpkg.com/@tensorflow/tfjs-core@2.1.0/dist/tf-core.js"></script>
        <script src="https://unpkg.com/@tensorflow/tfjs-converter@2.1.0/dist/tf-converter.js"></script>
        <script src="https://unpkg.com/@tensorflow/tfjs-backend-webgl@2.1.0/dist/tf-backend-webgl.js"></script>
        <!--Loading model of face detection.-->
        <script src="https://unpkg.com/@tensorflow-models/facemesh@0.0.4/dist/facemesh.js"></script>
        <!--Custom JavaScript for face tracking and camera control-->
        <script src="face_tracker.js"></script>
    </head>
    
    <body>
        <a-scene id="scene" background="color: #FAFAFA" style="position: absolute;" vr-mode="enabled: false" ar-mode="enabled: false" embedded="true">
            <!--Objects for shown in the virtual room-->
            <a-entity id="objects" position = "0 0 -0.5" scale="1 1 1">
                <!-- Instead of basic shapes, custom 3D models can be added (https://medium.com/@akashkuttappa/using-3d-models-with-ar-js-and-a-frame-84d462efe498) -->
                <!-- <a-entity fbx-model=”src: url(/path/to/nameOfFile.json);”></a-entity> -->
                <a-box position="-0.1 -0.05 0.1" scale="0.1 0.1 0.1" rotation="0 45 0" color="#4CC3D9" shadow></a-box>
                <a-sphere position="0 0.015 -0.1" radius="0.125" color="#EF2D5E" shadow></a-sphere>
                <a-cylinder position="0.1 -0.025 0.1" radius="0.05" height="0.15" color="#FFC65D" shadow></a-cylinder>
                <a-plane position="0 -0.11 0" rotation="-90 0 0" width="0.4" height="0.4" color="#7BC8A4" shadow></a-plane>
            </a-entity>
            <!--Virtual room-->
            <a-entity id="room" scale="1 1 1">
                <a-plane position="0 0.5 -0.5" rotation="90 0 0" src="/assets/wall01.png" ></a-plane>
                <a-plane position="0 -0.5 -0.5" rotation="-90 0 0" src="/assets/wall01.png" ></a-plane>
                <a-plane position="-0.5 0 -0.5" rotation="0 90 0" src="/assets/wall01.png" ></a-plane>
                <a-plane position="0.5 0 -0.5" rotation="0 -90 0" src="/assets/wall01.png"></a-plane>
                <a-plane position="0 0.0 -1" rotation="0 0 0" src="/assets/wall01.png"></a-plane>
            </a-entity>
            <!--Camera-->
            <a-entity camera position="0 0 0" ></a-entity>
        </a-scene>
        <!--Virtualize camera image-->
        <video id="video" style="position: absolute; width:320px; height:240px;"></video>
        
        <!--Instructions and status display-->
        <div id="instructions" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; font-family: Arial, sans-serif; font-size: 12px; max-width: 300px;">
            <div id="status">Initializing...</div>
            <div id="controls" style="margin-top: 10px;">
                <strong>Controls:</strong><br>
                WASD or Arrow Keys: Move camera<br>
                Q/E: Rotate camera<br>
                <em>Face tracking works without HTTPS, VR mode requires HTTPS</em>
            </div>
        </div>
    </body>
</html>